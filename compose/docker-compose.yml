services:
  frigate:
    image: ghcr.io/blakeblackshear/frigate:stable
    container_name: frigate
    restart: unless-stopped
    privileged: true
    shm_size: "256m"
    ports:
      - "5000:5000"
      - "8554:8554"
      - "8555:8555/tcp"
      - "8555:8555/udp"
    volumes:
      - /etc/frigate:/config:rw
      - /mnt/frigate:/media/frigate:rw    # ‚Üê CHANGE THIS from /media/frigate to /mnt/frigate
      - /etc/localtime:/etc/localtime:ro
    environment:
      - TZ=${TZ}
  nginx:
    image: nginx:stable
    container_name: reverse-proxy
    restart: unless-stopped
    depends_on: [frigate]
    network_mode: host
    volumes:
      - /etc/nginx/conf.d/default.conf:/etc/nginx/conf.d/default.conf:ro
      - /var/www/info:/usr/share/nginx/html:ro
      - /var/www/wireguard:/var/www/wireguard:ro
      # Add SSL certificates directory if using HTTPS
      - /etc/ssl/certs:/etc/ssl/certs:ro
      - /etc/ssl/private:/etc/ssl/private:ro
    environment:
      - TZ=${TZ}
  dnsmasq:
    image: ghcr.io/romancin/dnsmasq:latest
    container_name: dnsmasq
    restart: unless-stopped
    network_mode: "host"
    cap_add:
      - NET_ADMIN
    volumes:
      - /etc/dnsmasq/dnsmasq.conf:/etc/dnsmasq.conf:ro
    environment:
      - TZ=${TZ}
    # optional: comment out if you don't want local DNS
    profiles: ["lan-dns"]